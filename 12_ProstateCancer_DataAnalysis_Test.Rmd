---
title: "Data Processing"
author: "Team 2"
date: "2025-11-03"
output: pdf_document
---


```{r}

data <- read.csv("00_ProstateCancer_Data.csv", header=T)

```

```{r}

cols1 <- c("Tani_Tarihi", "Tedavi_Tarihi", "PSA_Takip_3ay", "PSA_Takip_6ay", "PSA_Takip_12ay", "BCR_Tarihi", "Metastaz_Tarihi", "Son_Takip_Tarihi")

data <- data[, !(names(data) %in% cols1)]

```

```{r}

cols2 <- c("Klinik_Evre", "Biyopsi_Gleason", "Risk_Grubu", "Komorbidite_Skor", "Tedavi_Tipi", "ADT_Tipi", "Patolojik_Evre", "Cerrahi_Sinir", "Final_Gleason", "BCR_Durum", "Metastaz_Durum", "Son_Durum")

data[cols2] <- lapply(data[cols2], as.factor)

```

```{r}

names(data) <- c("Patient ID", "Age", "PSA_before", "CTstage", "GleasonScore_before", "RiskClass", "Albumin", "Lymphocyte", "CRP", "NLR", "CallyIndex", "ComorbidityScore", "Treatment", "RadiationDose", "HormoneType", "HormonDuration" ,"TumorSize", "MarginStatus", "GleasonScore_after", "PSA_after", "BCR", "Metastasis", "Survival")

```



## Data Analysis 1: Chi-squared Test, Treatment vs BCR

### Hypotheses

H0: Treatment Type and Biochemical Recurrence (BCR) Status are independent. (The recurrence rate is the same across all treatment groups)

Ha: Treatment Type and Biochemical Recurrence (BCR) Status are not independent. (The recurrence rate is significantly different for at least one treatment group)

```{r}

bcr_table <- table(data$Treatment, data$BCR)
cat("Frequency Table (Counts):\n")
print(bcr_table)

bcr_test <- chisq.test(bcr_table)
cat("\nChi-squared Test Results:\n")
print(bcr_test)

cat("\nBCR Rate (%) within each Treatment Group:\n")
round(prop.table(bcr_table, margin = 1) * 100, 1)

```

**Conclusion**: Since the p-value (0.0294) is less than the significance level (a=0.05), we reject the null hypothesis (H0).

**Interpretation**: There is a statistically significant association between the type of treatment a patient receives and the likelihood of experiencing Biochemical Recurrence (BCR).

Highest Recurrence Rate: Treatment Type 3 (Hormone Therapy (ADT) Monotherapy) showed the highest biochemical recurrence rate at 43.7%.

Lowest Recurrence Rate: Treatment Type 1 (Radical Prostatectomy) showed the lowest recurrence rate at 25.6%.

```{r}

bcr_prop_table <- prop.table(bcr_table, margin = 1)

par(mar = c(5, 4, 4, 10) + 0.1)
barplot(
  t(bcr_prop_table) * 100,
  main = "Biochemical Recurrence (BCR) Rate by Treatment Type",
  xlab = "Treatment Type",
  ylab = "Percentage (%)",
  col = c("blue", "red"),
  legend.text = c("No Recurrence", "Recurrence"),
  args.legend = list(
    title = "Class", 
    x = "topright",
    inset = c(-0.5, 0),
    xpd = TRUE,
    cex = 0.8
  ),
  ylim = c(0, 100),
  names.arg = c("RP", "RT", "ADT", "RT + ADT")
)

```



## Data Analysis 2: Chi-squared Test, Treatment vs Survival

### Hypotheses

H0: Treatment Type and Survival Status are independent. (The survival rate is the same across all treatment groups)

Ha: Treatment Type and Survival Status are not independent. (The survival rate is significantly different for at least one treatment group)

```{r}

survival_table <- table(data$Treatment, data$Survival)
cat("Frequency Table (Counts):\n")
print(survival_table)

survival_test <- chisq.test(survival_table)
cat("\nChi-squared Test Results:\n")
print(survival_test)

cat("\nSurvival Rate (%) within each Treatment Group (Survival = Alive):\n")
round(prop.table(survival_table, margin = 1) * 100, 1)

```

**Conclusion**: Since the p-value (0.2034) is greater than the significance level (a=0.05), we fail to reject the null hypothesis (H0).

**Interpretation**: There is no statistically significant association between the type of treatment a patient receives and the likelihood of their Survival Status (Alive vs Deceased).

```{r}

survival_prop_table <- prop.table(survival_table, margin = 1)

par(mar = c(5, 4, 4, 10) + 0.1)
barplot(
  t(survival_prop_table) * 100,
  main = "Survival Rate by Treatment Type",
  xlab = "Treatment Type",
  ylab = "Percentage (%)",
  col = c("blue", "red"),
  legend.text = c("Alive", "Deceased"),
  args.legend = list(
    title = "Class", 
    x = "topright",
    inset = c(-0.5, 0),
    xpd = TRUE,
    cex = 0.8
  ),
  ylim = c(0, 100),
  names.arg = c("RP", "RT", "ADT", "RT + ADT")
)

```



## Data Analysis 3: ANOVA Test, Treatment vs PSA at diagnosis

### Hypotheses

H0: PSA at diagnosis is the same across all four Treatment Type groups

Ha: PSA at diagnosis is significantly different for at least one treatment group

```{r}

anova_result <- aov(PSA_before ~ Treatment, data = data)

summary(anova_result)

TukeyHSD(anova_result)

```

**Conclusion**: Since the p-value (1.6e-06) is less than the significance level (a=0.05), we reject the null hypothesis (H0).

**Interpretation**: There is a statistically significant difference in the mean PSA at diagnosis (PSA_before) among the different treatment groups.

**Tukey's HSD Interpretation**:

The mean PSA at diagnosis for the Radical Prostatectomy (Treatment 1) group is significantly smaller than the mean PSA at diagnosis for all other treatment groups (Treatment 2, 3, and 4).

The difference between Treatment 3 and Treatment 1 showed the largest mean difference (diff=30.21). This indicates that the Treatment 3 (Hormone Therapy Monotherapy) group had the highest average PSA at diagnosis, while Treatment 1 had the lowest.

There is no significant difference in the mean PSA at diagnosis among the three non-surgical groups (Treatment 2, 3, and 4) in their pairwise comparisons.


```{r}

par(mar = c(5, 4, 4, 2) + 0.1)
boxplot(PSA_before ~ Treatment,
        data = data,
        main = "PSA at Diagnosis Distribution by Treatment Type",
        xlab = "Treatment Type",
        ylab = "PSA at diagnosis",
        col = rainbow(4),
        names = c("RP", "RT", "ADT", "RT + ADT")
)

means <- tapply(data$PSA_before, data$Treatment, mean, na.rm=TRUE)
points(means, pch = 8, col = "black", cex = 1.5)

```
