---
title: Treatment Effectiveness in Patients with Prostate Cancer
author: Jennifer Cho, Narya Elhawary, Minsol Seo
date: "Due 2025-12-05"
output:
  pdf_document:
    latex_engine: xelatex
---


```{r setup, include=FALSE}

source("00_requirements.R")

```


\begin{center}


Abstract

  This project aims to analyze which treatment option for prostate cancer leads to the highest recovery rate among patients. Prostate cancer is one of the most common cancers among men and is ranked as the "second most frequently diagnosed cancer"(Rawla, 2019). It also remains the "fifth leading cause of death worldwide" (Rawla, 2019), making the identification of the most effective treatment essential. As research in cancer therapy continues to expand, it is imperative to compare the overall effectiveness of different treatment methods, including hormonal therapy, radiation therapy, surgery, and combination therapies, to determine whether a single or combined approach yields better recovery outcomes. This study will evaluate tumor size, initial PSA levels, and biopsy Gleason scores over a one-year period to compare patient recovery and cancer recurrence. Statistical analyses will identify patterns of effectiveness among various treatments and determine which method best improves survival rates while reducing recurrence. It is hypothesized that combination treatments will decrease survival and decrease recurrence, whereas single therapies may yield higher recurrence rates but increased survival rates. By analyzing these relationships, this project seeks to highlight how treatment choice influences recovery rates, recurrence, and long-term survival outcomes for prostate cancer patients.

\end{center}

## 1) Introduction:
  The primary purpose of this analysis is to compare and quantify the long-term differential effectiveness of major treatment modalities for prostate cancer—specifically surgery, radiotherapy, hormonal therapy, and a combination of hormonal therapy with radiotherapy. The goal is to apply meticulous statistical methods and rigorous data analysis to determine which specific treatment provides the best outcomes for patient survival and recovery, as well as whether combining therapies is more effective than single-treatment approaches. This study directly addresses the central research question: “What is the differential effectiveness of primary treatment modalities on clinical survival rates and biochemical recurrence outcomes for prostate cancer patients after controlling for prognostic factors?” The analysis is designed to benefit patients by identifying treatments with the most durable effectiveness, while also assisting families and clinicians in making informed decisions based on reliable statistical evidence. By providing outcome-based comparisons, this research aims to guide more personalized treatment strategies tailored to each patient’s risk profile and cancer stage. Patient-specific factors, including initial cancer stage (severity and aggressiveness), overall health status, tumor size, initial PSA levels, and biopsy Gleason scores, will be considered. A multivariable regression model will be employed to isolate the effectiveness of treatment type while controlling for these prognostic factors to test the hypothesis that significant differences exist in long-term outcomes among first-line treatments..


## 2) Data:
  The data used for this analysis were retrieved from the Zenodo repository, a well-known open-access repository mainly used by science communities. A dataset we're using, titled “Comprehensive Clinical, Pathological and Follow-up Dataset of Prostate Cancer Patients,” was collected and published by Mert Başaranoğlu at Mersin Üniversitesi Hastanesi (Mersin University Hospital) in southern Turkey. It contains detailed information on factors related to Prostate Cancer, including 30 variables spanning four broader categories: Clinical Parameters, Treatment Information, Pathological Outcomes, and Follow-up Data.

## 2-1) Dataset Variables:

```{r, echo=FALSE}

clinical <- "Clinical cT-Stage determined by pre-treatment examinations (cT1c < cT2a < cT2b < cT2c < cT3a < cT3b for increasing extent of tumor invasion)"
biopsy <- "Biopsy Gleason Score (3+3 < 3+4 < 4+3 < 3+5 < 4+4 < 4+5 < 5+4 < 5+5, higher score indicates higher aggressiveness)"


colA <- c("Hasta_ID",
          "Yas",
          "Tani_Tarihi",
          "PSA_Tani",
          "Klinik_Evre",
          "Biyopsi_Gleason",
          "Risk_Grubu")
colB <- c("Patient ID",
          "Age",
          "Diagnosis Date",
          "Serum Prostate-Specific Antigen (PSA) level at diagnosis (ng/mL)",
          clinical,
          biopsy,
          "Risk Group Classification (1 for Low, 2 for Intermediate, 3 forHigh)"
          )
colC <- c("Categorical",
          "Discrete",
          "Date",
          "Continuous",
          "Ordinal/Categorical",
          "Ordinal/Categorical",
          "Ordinal/Categorical")

table_initial <- data.frame(
  Variable_Name = colA,
  English_Translation = colB,
  Type_of_Data = colC
)

table_initial %>%
  kable(caption = "Initial Diagnosis Variables", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position") %>%
  column_spec(2, width = "6cm")

```

```{r, echo=FALSE}

neutro <- "Neutrophil-to-Lymphocyte Ratio. A prognostic indicator for systemic inflammation and cancer aggressiveness."
cally <- "CALLY Index. A composite index, likely related to inflammation or blood components."
comorbidity <- "Comorbidity Score indicating the severity of other co-existing chronic diseases ( 0 (No comorbidities) < ... < 5 (Severe comorbidities))"

colA <- c("Albumin",
          "Lenfosit",
          "CRP",
          "NLR",
          "CALLY_Index",
          "Komorbidite_Skor")
colB <- c("ASerum albumin level (g/dL). Indicator of nutritional status and systemic health",
          "Lymphocyte (Immune system component) Count",
          "C-Reactive Protein (mg/L). Indicator of inflammation",
          neutro,
          cally,
          comorbidity
          )
colC <- c("Continuous",
          "Discrete",
          "Continuous",
          "Continuous",
          "Continuous",
          "Ordinal/Categorical")

table_risk <- data.frame(
  Variable = colA,
  In_English = colB,
  Type_of_Data = colC
)

table_risk %>% 
  kable(caption = "Risk Factors", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position") %>%
  column_spec(2, width = "6cm")

```


### Treatment Information

```{r, echo=FALSE}

main <- "Main Treatment Type received (1 for Radical Prostatectomy, 2 for
Radiotherapy/RT, 3 for Hormone Therapy, 4 for Combination of Radiotherapy and Hormone Therapy)"

colA <- c("Tedavi_Tipi",
          "Tedavi_Tarihi",
          "RT_Dozu",
          "ADT_Tipi",
          "ADT_Suresi"
          )
colB <- c(main,
          "Treatment Date",
          "Total Radiation Dose (in Gy), if radiotherapy was performed",
          "Androgen Deprivation Therapy (ADT, hormone therapy) Type used",
          "ADT(hormone therapy) Duration"
          )
colC <- c("Categorical",
          "Date",
          "Continuous",
          "Categorical",
          "Continuous"
          )

table_info <- data.frame(
  Variable = colA,
  In_English = colB,
  Type_of_Data = colC
)

table_info %>%
  kable(caption = "Treatment Information", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position") %>% 
  column_spec(2, width = "5cm")

```

```{r, echo=FALSE}

final <- "Final Tumor Pathological Stage determined after surgery on the removed tissue (pT2a < pT2b < pT2c < pT3a < pT3b < pT4, NaN indicates patient did not undergo surgery)"
sinir <- "Surgical Margin Status indicating if cancer cells were present at the edge of the removed tissue. Crucial for recurrence prediction (0: Negative, 1: Positive, NaN indicates patient did not undergo surgery)."
gleason <- "Final Gleason Score confirmed from the final excised tissue (3+3 < 3+4 < 4+3 < 3+5 < 4+4 < 4+5 < 5+4 < 5+5, higher score indicates higher aggressiveness)"

colA <- c("Patolojik_Evre",
          "Cerrahi_Sinir",
          "Final_Gleason"
          )
colB <- c(final,
          sinir,
          gleason
          )
colC <- c("Ordinal/Categorical",
          "Binary/Categorical",
          "Ordinal/Categorical"
          )

table_marker <- data.frame(
  Variable = colA,
  In_English = colB,
  Type_of_Data = colC
)

table_marker %>%
  kable(caption = "Pathological Markers", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position") %>%
  column_spec(2, width = "6cm") 

```


```{r, echo=FALSE}

lowest <- "The lowest PSA level reached after treatment (ng/mL). A lower nadir generally indicates better treatment success"
biochemical <- "Biochemical Recurrence (BCR) Status whether the PSA level rise above a recurrence threshold? (True for Recurrence occurred, False for no Recurrence occurred)"
metastas <- "Metastasis Status whether distant metastasis occur during follow-up? (0 for No, 1 for Yes)"
survival <- "Patient’s Survival Status at the last follow-up (0 for Alive, 1 for Deceased)"

colA <- c("PSA_Nadir",
          "PSA_Takip_3ay / 6ay / 12ay",
          "BCR_Durum",
          "BCR_Tarihi",
          "Metastaz_Durum",
          "Metastaz_Tarihi",
          "Son_Durum",
          "Son_Takip_Tarihi"
          )
colB <- c(lowest,
          "Follow-up PSA levels (ng/mL) measured at at 3/6/12 Months",
          biochemical,
          "Date when biochemical recurrence was confirmed",
          metastas,
          "Date when metastasis was confirmed",
          survival,
          "Date of the last recorded patient information."
          )
colC <- c("Continuous",
          "Continuous",
          "Binary/Categorical",
          "Date",
          "Binary/Categorical",
          "Date",
          "Binary/Categorical",
          "Date"
          )

table_marker <- data.frame(
  Variable = colA,
  In_English = colB,
  Type_of_Data = colC
)

table_marker %>% 
  kable(caption = "Follow-up \\& Outcomes", booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position") %>%
  column_spec(2, width = "7cm")

```

### 2-2) Data Cleaning
To make data sets more consistent, we then decided to delete unnecessary information by removing the corresponding columns. Afterward, converting all categorical variables into factor type was required to ensure that our program, R(Studio), correctly interprets them as discrete categories rather than as continuous values or even strings. Moreover, this foreign data set has named its critical variables in another language that we need to rename in English. Lastly, addressing missing variables and visualizing were involved in each of them in various forms. These process allow us to observe that missing values were only found for the Hormone Type (ADT_Tipi) variable in patients who did not receive Hormone Therapy (as it is not applicable). Also, information is only present for the specific treatment a patient received (e.g., Radiation Dose is missing for surgery patients and vise versa).

```{r, echo=FALSE, results='hide'}

data <- read.csv("00_ProstateCancer_Data.csv", header=T)

cols1 <- c("Tani_Tarihi", "Tedavi_Tarihi", "PSA_Takip_3ay", "PSA_Takip_6ay", "PSA_Takip_12ay", "BCR_Tarihi", "Metastaz_Tarihi", "Son_Takip_Tarihi")
data <- data[, !(names(data) %in% cols1)]

cols2 <- c("Klinik_Evre", "Biyopsi_Gleason", "Risk_Grubu", "Komorbidite_Skor", "Tedavi_Tipi", "ADT_Tipi", "Patolojik_Evre", "Cerrahi_Sinir", "Final_Gleason", "BCR_Durum", "Metastaz_Durum", "Son_Durum")
data[cols2] <- lapply(data[cols2], as.factor)

names(data) <- c("Patient ID", "Age", "PSA_before", "CTstage", "GleasonScore_before", "RiskClass", "Albumin", "Lymphocyte", "CRP", "NLR", "CallyIndex", "ComorbidityScore", "Treatment", "RadiationDose", "HormoneType", "HormonDuration" ,"TumorSize", "MarginStatus", "GleasonScore_after", "PSA_after", "BCR", "Metastasis", "Survival")

```


### 3) Visualization:
  We use preliminary visualizations and numerical summaries in order to prepare and interpreting the two multivariate logistic regression models and one linear regression, as this step is essential for diagnosing data quality, identifying confounding factors, and assessing the signal strength before the formal statistical analysis begins. We’ve established a few bar graphs on the frequency of treatment type, frequency of biochemical recurrence status, survival status, and risk factors. The box plots on PSA level at diagnosis and after treatment will be used to directly confound our numerical data among different treatment groups, as well as interpreting information from risk factors through our numerical summary.

  
  
```{r, echo=FALSE, results='hide'}

sum(is.na(data$Treatment))

table(data$Treatment)
round(prop.table(table(data$Treatment)), 3)

frequencies <- table(data$Treatment)

names(frequencies) <- c("Surgery", "RT", "Hormone", "RT + Hormone")

barplot(
    frequencies,
    main = "Frequency of Treatment Type (Treatment)",
    xlab = "Treatment Type",
    ylab = "Number of Patients",
    col = rainbow(4),
    ylim = c(0, max(frequencies) * 1.1)
    )

```
Figure 1: Illustration of distribution of the four main treatment groups across the patient cohort.


```{r, echo=FALSE, results='hide', fig.width=9, fig.height=5}

par(mfrow = c(1, 2))

sum(is.na(data$BCR))
table(data$BCR)

frequencies_bcr <- table(data$BCR)

names(frequencies_bcr) <- c("No Recurrence", "Recurrence")

barplot(
    frequencies_bcr,
    main = "Frequency of Biochemical Recurrence Status",
    xlab = "Recurrence Status",
    ylab = "Number of Patients",
    col = c("blue", "red"),
    ylim = c(0, max(frequencies_bcr) * 1.1)
    )

sum(is.na(data$Survival))
table(data$Survival)


frequencies_survival <- table(data$Survival)

names(frequencies_survival) <- c("Alive", "Deceased")

barplot(
    frequencies_survival,
    main = "Frequency of Survival Status",
    xlab = "Survival Status",
    ylab = "Number of Patients",
    col = c("blue", "red"),
    ylim = c(0, max(frequencies_survival) * 1.1)
    )

par(mfrow = c(1, 1))

```
 
Figure 2: Side-by-side bar plots for Biochemical Recurrence (BCR) and Survival Status to display the main outcomes. 

As shown in Figure 2, the data exhibit a low overall recurrence rate of Biochemical Recurrence (BCR), with the majority of patients (69.3%) successfully avoiding recurrence, which is represented as 'False'. However, the surprising and ironic cohort is Survival Status, where 0 = Alive and 1 = Deceased, showing that the survival rate is significantly low, with only 11.8% alive. 



```{r, echo=FALSE, results='hide', fig.width=9, fig.height=5}

PSA <- c("PSA_before", "PSA_after")
sapply(data[, PSA], function(x) sum(is.na(x)))

summary(data[, PSA])

par(mfrow = c(1, 2))

boxplot(data[["PSA_before"]],
          main = "Box Plot of PSA level at diagnosis",
          col = "grey")

boxplot(data[["PSA_after"]],
          main = "Box Plot of PSA level after treatment",
          col = "green")

```
Figure 3: Comparison of PSA level before and after treatment on Diagnosis


Figure 3 displays the distributions and central tendencies of Prostate-Specific Antigen (PSA) levels at the time of diagnosis and after primary treatment. The box plots and numerical summaries illustrate a significant and positive effect of the treatment modalities on reducing PSA levels in the cohort. Before treatment (PSA_before), the median PSA level was 59.35 ng/mL, with values ranging up to 150.00 ng/mL. Following treatment (PSA_after), the median level dropped dramatically to just 0.1900 ng/mL, with most values lying significantly below the pre-treatment range. This substantial decrease in both the median and quartiles (as evidenced by the significant drop from the 1st Quartile of 18.10 to 0.0400 indicates that the treatments were immediately successful in reducing the primary tumor burden and systemic PSA activity in the majority of patients. This observation aligns with clinical expectations, in which successful treatment should drive PSA levels to near-undetectable levels (nadir).


### 4) Analysis aims:

## PART A) TEST
  
### 4-1) Chi-squared Test on Treatment vs. BCR

A Chi-squared test was performed to examine the association between Biochemical Recurrence (BCR) and treatment type.

- Null Hypothesis (H0): Treatment Type and Biochemical Recurrence (BCR) Status are independent (The recurrence rate is the same across all treatment groups.)

- Alternative Hypothesis (Ha): Treatment Type and Biochemical Recurrence (BCR) Status are not independent (The recurrence rate is significantly different for at least one treatment group.)


```{r, echo=FALSE}

data$Treatment_Label <- factor(data$Treatment,
                               levels = c(1, 2, 3, 4),
                               labels = c("Radical Prostatectomy", 
                                          "Radiotherapy (RT)", 
                                          "Hormone Monotherapy", 
                                          "Combination (RT + Hormone)"))

bcr_table <- table(data$Treatment_Label, data$BCR)
df_combined <- as.data.frame.matrix(bcr_table)

df_combined$Total_Count <- rowSums(df_combined)

bcr_rates_pct <- prop.table(bcr_table, margin = 1) * 100
df_combined$No_Recurrence_Pct_False <- round(bcr_rates_pct[, "False"], 1)
df_combined$Recurrence_Pct_True <- round(bcr_rates_pct[, "True"], 1)

df_final <- df_combined[, c("False", "True", "No_Recurrence_Pct_False", "Recurrence_Pct_True")]
df_final$Treatment_Type <- rownames(df_final)
df_final <- df_final[, c(5, 1, 2, 3, 4)]
names(df_final) <- c("Treatment Type",
                     "Recurrence Count (False)",
                     "Recurrence Count (True)", 
                     "No Recurrence (%) (False)",
                     "Recurrence (%) (True)")

df_final %>%
  kable(caption = "4.1 Association between Treatment Type and Biochemical Recurrence (BCR)", 
        booktabs = TRUE,
        linesep = "",
        align = c('l', 'c', 'c', 'c', 'c')) %>% 
  kable_styling(latex_options = "hold_position") %>%
  column_spec(1, width = "1.8in") %>% 
  column_spec(2:5, width = "0.8in")


bcr_test <- chisq.test(bcr_table) 
cat("\n\n")
cat(paste0("Chi-squared = ", round(bcr_test$statistic, 4), ", df = ", bcr_test$parameter, ", p-value = ", round(bcr_test$p.value, 4)))

```

The Chi-squared test yielded a test statistic of chi^2 = 8.9915 with a corresponding p-value of 0.0294. Since the p-value is less than the significance level (alpha (a) = 0.05), we reject the null hypothesis. There is a statistically significant association between the type of treatment a patient receives and the likelihood of experiencing Biochemical Recurrence (BCR). 



```{r, echo=FALSE}

bcr_prop_table <- prop.table(bcr_table, margin = 1)

par(mar = c(5, 4, 4, 10) + 0.1)
barplot(
  t(bcr_prop_table) * 100,
  main = "Biochemical Recurrence (BCR) Rate by Treatment Type",
  xlab = "Treatment Type",
  ylab = "Percentage (%)",
  col = c("blue", "red"),
  legend.text = c("No Recurrence", "Recurrence"),
  args.legend = list(
    title = "Class", 
    x = "topright",
    inset = c(-0.5, 0),
    xpd = TRUE,
    cex = 0.8
  ),
  ylim = c(0, 100),
  names.arg = c("RP", "RT", "ADT", "RT + ADT")
)

```

Hormone Monotherapy had the highest recurrence rate at 43.7%, while Radical Prostatectomy had the lowest at 25.6%. The bar plot visually confirms this, with the red recurrence portion for Hormone Monotherapy (ADT) notably larger and the recurrence portion for Radical Prostatectomy (RP) noticeably smaller compared to other treatment methods.



### 4-2) Chi-squared Test on Treatment vs. Survival

A Chi-squared test was performed to examine the association between Biochemical Recurrence (BCR) and treatment type.

- Null Hypothesis (H0): Treatment Type and Biochemical Recurrence (BCR) Status are independent (The survival  rate is the same across all treatment groups.)

- Alternative Hypothesis (Ha): Treatment Type and Biochemical Recurrence (BCR) Status are not independent (The survival rate is significantly different for at least one treatment group.)


```{r, echo=FALSE}

data$Treatment_Label <- factor(data$Treatment,
                               levels = c(1, 2, 3, 4),
                               labels = c("Radical Prostatectomy", 
                                          "Radiotherapy (RT)", 
                                          "Hormone Monotherapy", 
                                          "Combination (RT + Hormone)"))

survival_table <- table(data$Treatment_Label, data$Survival)
df_combined_s <- as.data.frame.matrix(survival_table)

survival_rates_pct <- prop.table(survival_table, margin = 1) * 100
df_combined_s$Survival_Pct_Alive <- round(survival_rates_pct[, "0"], 1) # 0 = Alive
df_combined_s$Mortality_Pct_Deceased <- round(survival_rates_pct[, "1"], 1) # 1 = Deceased

df_final_s <- df_combined_s[, c("0", "1", "Survival_Pct_Alive", "Mortality_Pct_Deceased")] 
df_final_s$Treatment_Type <- rownames(df_final_s)

df_final_s <- df_final_s[, c(5, 1, 2, 3, 4)] 
names(df_final_s) <- c("Treatment Type", 
                     "Count (Alive)", 
                     "Count (Deceased)", 
                     "Survival (%) (Alive)", 
                     "Mortality (%) (Deceased)")

df_final_s %>%
  kable(caption = "Table 4.2: Association between Treatment Type and Survival Status", 
        booktabs = TRUE,
        linesep = "",
        col.names = c("Treatment Type", 
                      "Count (Alive)", "Count (Deceased)", 
                      "Survival (%)", "Mortality (%)"),
        align = c('l', 'c', 'c', 'c', 'c')) %>% 
  kable_styling(latex_options = "hold_position") %>%
  column_spec(1, width = "1.8in") %>% 
  column_spec(2:5, width = "0.8in")

survival_test <- chisq.test(survival_table) 
cat("\n\n")
cat(paste0("Chi-squared = ", round(survival_test$statistic, 4), ", df = ", survival_test$parameter, ", p-value = ", round(survival_test$p.value, 4)))

```

The Chi-squared test yielded a test statistic of chi^2 = 4.6021 with a corresponding p-value of 0.2034. Since the p-value is greater than the significance level (alpha (a) =0.05), we fail to reject the null hypothesis (H0). Therefore, we can conclude that there is no statistically significant association between the type of treatment a patient receives and the likelihood of their Survival Status (Alive vs. Deceased). The bar plot also supports this conclusion, showing that the distribution of survival rates is not substantially different across the four treatment types.


```{r, echo=FALSE}

survival_prop_table <- prop.table(survival_table, margin = 1)

par(mar = c(5, 4, 4, 10) + 0.1)
barplot(
  t(survival_prop_table) * 100,
  main = "Survival Rate by Treatment Type",
  xlab = "Treatment Type",
  ylab = "Percentage (%)",
  col = c("blue", "red"),
  legend.text = c("Alive", "Deceased"),
  args.legend = list(
    title = "Class", 
    x = "topright",
    inset = c(-0.5, 0),
    xpd = TRUE,
    cex = 0.8
  ),
  ylim = c(0, 100),
  names.arg = c("RP", "RT", "ADT", "RT + ADT")
)

```

The bar plot also supports this conclusion, showing that the survival rate distribution is not substantially different across the four treatment types.


### 4-3) ANOVA Test, Treatment vs PSA Difference

An ANOVA was conducted to compare mean PSA at diagnosis (PSA_before) across the four Treatment Type groups.

- Null Hypothesis (H0): PSA at diagnosis is the same across all four Treatment Type groups

- Alternative Hypothesis (Ha): Alternative Hypothesis (H1)는 PSA at diagnosis is significantly different for at least one treatment group

```{r, echo=FALSE}

suppressWarnings({

mean_psa_df <- data.frame(
  Treatment_Type = c("Radical Prostatectomy", "Radiotherapy (RT)", "Hormone Monotherapy", "Combination (RT + Hormone)"),
  Mean_Delta_PSA = c(53.905, 68.503, 83.659, 70.428)
)

mean_psa_df %>%
  kable(caption = "Table 4.4: Mean PSA Reduction (Delta PSA) by Treatment Type", 
    booktabs = TRUE,
    linesep = "",
    col.names = c("Treatment Type",
    "Mean Reduction (PSA_before - PSA_after)"),
    align = c('l', 'r')) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"), full_width = FALSE) %>%
  column_spec(1, width = "2.0in") %>% # 레이블 길이에 맞게 너비 지정
  column_spec(2, width = "1.5in")


tukey_data <- data.frame(
  Group_1 = c("Radical Prostatectomy", "Radical Prostatectomy", "Radical Prostatectomy", 
              "Radiotherapy (RT)", "Radiotherapy (RT)", "Hormone Monotherapy"),
  Group_2 = c("Radiotherapy (RT)", "Hormone Monotherapy", "Combination (RT + Hormone)", 
              "Hormone Monotherapy", "Combination (RT + Hormone)", "Combination (RT + Hormone)"),
  Mean_Difference = c(14.598, 29.754, 16.523, 15.157, 1.925, -13.232),
  p_value = c(0.0056, 0.0000, 0.0151, 0.0821, 0.9874, 0.2536),
  Significant = c("Yes", "Yes", "Yes", "No", "No", "No")
)

tukey_data %>%
  kable(caption = "Table 4.5: Tukey's HSD Post-Hoc Test for Delta PSA", # Table 4.5로 변경
      booktabs = TRUE,
      linesep = "",
    col.names = c("Group 1", "Group 2", "Mean Diff.", "p-value", "Sig. (p < 0.05)"), 
    align = c('l', 'l', 'r', 'r', 'c')) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"), full_width = FALSE) %>%
  column_spec(1:2, width = "1.6in") %>%
  column_spec(3:5, width = "0.6in")

})

```

The ANOVA test yielded a p-value of 1.6e-6 (0.0000016). Since the p-value is much less than the significance level (alpha (a) =0.05), we reject the null hypothesis (H0). Thus, there is a statistically significant difference in the mean PSA at diagnosis (PSA_before) among the different treatment groups.

Since the ANOVA test confirmed a significant difference, a Tukey HSD post hoc test was performed to identify which specific pairs of groups differ significantly.

The mean PSA at diagnosis for the Radical Prostatectomy (Treatment 1) group is significantly lower than that for all other treatment groups (Treatment 2, 3, and 4). There is no significant difference in the mean PSA at diagnosis among the three non-surgical groups (Treatment 2, 3, and 4) in their pairwise comparisons. The comparison between Hormone Therapy Monotherapy (Treatment 3) and Radical Prostatectomy (Treatment 1) showed the most considerable mean difference (diff = 30.21). This indicates that the Treatment 3 group had the highest average PSA at diagnosis, whereas the Treatment 1 group had the lowest.


```{r, echo=FALSE}

par(mar = c(5, 4, 4, 2) + 0.1)
boxplot(PSA_before ~ Treatment,
        data = data,
        main = "PSA at Diagnosis Distribution by Treatment Type",
        xlab = "Treatment Type",
        ylab = "PSA at diagnosis",
        col = rainbow(4),
        names = c("RP", "RT", "ADT", "RT + ADT")
)

means <- tapply(data$PSA_before, data$Treatment, mean, na.rm=TRUE)
points(means, pch = 8, col = "black", cex = 1.5)


```
The box plot visually confirms these findings: the PSA distribution for the Radical Prostatectomy (RP) group is noticeably lower than that of all other groups, and its mean value (often marked by a symbol) is the lowest. Conversely, the distribution and mean value for the Hormone Monotherapy (ADT) group are distinctly higher than those for the RP group, visually confirming that patients selected for RP had the lowest initial PSA levels at diagnosis.

## PART B) MODELING

## Data Analysis 0: Correlation between Variables

```{r, echo=FALSE}

vars <- c("Age", "PSA_before", "CTstage", "GleasonScore_before", "Albumin", "Lymphocyte", "CRP", "NLR", "CallyIndex", "ComorbidityScore")

pairs(data[, vars])

```



## Data Analysis 1: Logistic Regression (BCR)

```{r, echo=FALSE}

bcr_model <- glm(BCR ~ Age + PSA_before + CTstage + GleasonScore_before + Albumin + Lymphocyte + CRP + NLR + CallyIndex + ComorbidityScore + Treatment, data = data, family = binomial, na.action = na.omit)

summary(bcr_model)

plot(bcr_model, which = 1)

```

```{r, echo=FALSE}

bcr_model <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)

summary(bcr_model)

plot(bcr_model, which = 1)

```



## Data Analysis 2: Logistic Regression (Survival)

```{r, echo=FALSE}

survival_model <- glm(Survival ~ Age + PSA_before + CTstage + GleasonScore_before + Albumin + Lymphocyte + CRP + NLR + CallyIndex + ComorbidityScore + Treatment, data = data, family = binomial, na.action = na.omit)

summary(survival_model)

plot(survival_model, which= 2)

```

```{r, echo=FALSE}

survival_model <- glm(Survival ~ Treatment, data = data, family = binomial, na.action = na.omit)

summary(survival_model)

plot(survival_model, which = 2)

```



## Model Interpretation 1: Logistic Regression (BCR ~ Treatment)

```{r, echo=FALSE}

data$Treatment <- relevel(data$Treatment, ref = 3)

bcr_model_t3 <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)

summary(bcr_model_t3)

```



## Model Interpretation 2: Logistic Regression (BCR ~ Combination)

```{r, echo=FALSE}

data$Combination <- ifelse(data$Treatment == 4, "Yes", "No")
data$Combination <- as.factor(data$Combination)

bcr_model_2 <- glm(BCR ~ PSA_before + Combination, data = data,family = binomial, na.action = na.omit)

summary(bcr_model_2)

```



## Model Evaluation:

### Model Fitting and Predicting

```{r, echo=FALSE}

vars_for_model <- c("BCR", "PSA_before", "Treatment")
model_data <- data[complete.cases(data[, vars_for_model]), vars_for_model]

set.seed(123)
split_tag <- sample.split(model_data$BCR, SplitRatio = 0.70)
train_set <- subset(model_data, split_tag == TRUE)
test_set <- subset(model_data, split_tag == FALSE)

set.seed(123)
balanced_train_data <- ovun.sample(
    BCR ~ ., 
    data = train_set, 
    method = "over", 
    N = 2 * sum(train_set$BCR == "False") 
)$data

bcr_model_train <- glm(BCR ~ PSA_before + Treatment,data = balanced_train_data, family = binomial)

test_probabilities <- predict(bcr_model_train, newdata = test_set, type = "response")

```


### Evaluating: AUC (Area Under the Curve)

```{r, echo=FALSE}

roc_obj <- roc(test_set$BCR, test_probabilities)
auc_score <- auc(roc_obj)
cat(sprintf("AUC (Area Under the Curve): %.4f\n", auc_score))

```

### Confusion Matrix (Threshold 0.5)

```{r, echo=FALSE}
test_predictions <- ifelse(test_probabilities > 0.5, "True", "False")
conf_matrix <- table(Predicted = test_predictions, Actual = test_set$BCR)
conf_matrix <- conf_matrix[, c("False", "True")]

cat("Confusion Matrix (Threshold 0.5):\n")
print(conf_matrix)

accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
sensitivity <- conf_matrix["True", "True"] / sum(conf_matrix[, "True"])
specificity <- conf_matrix["False", "False"] / sum(conf_matrix[, "False"])

cat(sprintf("   Accuracy: %.4f\n", accuracy))
cat(sprintf("   Sensitivity: %.4f\n", sensitivity))
cat(sprintf("   Specificity: %.4f\n", specificity))

```

  
### 5) Conclusion: 
  


### Work Cited (Used in Abstract)
Rawla P. (2019). Epidemiology of Prostate Cancer. World journal of oncology, 10(2), 63–89. https://doi.org/10.14740/wjon1191
