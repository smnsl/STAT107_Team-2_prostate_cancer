}
}
df_red <- df[!missing, ]
return(df_red)
}
#######################################################
#######################################################
to_factors <- function(df) { ## Turn all character variables to factors.
n_vars <- ncol(df)
for (var_ind in 1:n_vars) {
var <- df[, var_ind]
if (class(var) == "character") {
df[, var_ind] <- factor(var)
}
}
return(df)
}
source("http://www.openintro.org/stat/data/cdc.R")
remove_na(cdc)
to_factors(cdc)
cdc_clean <- cdc[1000,]
cdc_clean
cdc_clean <- cdc[1:1000,]
cdc_clean
color_by_gender <- ifelse(cdc_clean$gender == "f", "forestgreen", "darkred")
pointstyle_by_gender <- ifelse(cdc_clean$gender == "f", 17, 8)
names(cdc_clean) [5] <- "Height (in.)"
names(cdc_clean) [6] <- "Weight (lbs)"
names(cdc_clean) [7] <- "Desired Weight (lbs)"
names(cdc_clean) [8] <- "Age (Years)"
names(cdc_clean) [9] <- "Gender"
variable_name_D <- colnames(cdc_clean)[5]
boxplot(cdc_clean[[variable_name_D]] ~ cdc_clean$Gender,
main = variable_name_D,
ylab = variable_name_D,
xlab = "Gender")
boxplot(cdc_clean[["Height (in.)"]] ~ cdc_clean$Gender,
main = variable_name_D,
ylab = variable_name_D,
xlab = "Gender")
variable_name <- colnames(cdc_clean)[5]
boxplot(cdc_clean[[variable_name]] ~ cdc_clean$Gender,
main = "boxplot of the variable Height (in.)",
ylab = variable_name,
xlab = "Gender")
numeric_vars <- c(5, 6, 7, 8)
par(mfrow = c(1, 4))
for (i in numeric_vars) {
variable_name_E <- colnames(cdc_clean)[i]
boxplot(cdc_clean[[variable_name_E]] ~ cdc_clean$Gender,
main = variable_name_E,
ylab = variable_name_E,
xlab = "Gender",
)
}
numeric_vars <- c(5, 6, 7, 8)
par(mfrow = c(1, 4))
for (i in numeric_vars) {
variable_name_E <- colnames(cdc_clean)[i]
boxplot(cdc_clean[[variable_name_E]] ~ cdc_clean$Gender,
main = variable_name_E,
ylab = variable_name_E,
xlab = "Gender",
)
}
par(mfrow = c(1, 1))
numeric_vars <- c(5:8)
par(mfrow = c(1, 4))
for (i in numeric_vars) {
variable_name_E <- colnames(cdc_clean)[i]
boxplot(cdc_clean[[variable_name_E]] ~ cdc_clean$Gender,
main = variable_name_E,
ylab = variable_name_E,
xlab = "Gender",
)
}
par(mfrow = c(1, 1))
data <- read.csv("~/Desktop/3-2/Introduction to Statistical Computing With R/Final Project/prostat_ca_veri_seti_duzeltilmis_v2.csv", header=T)
str(data)
data <- read.csv("00_ProstateCancer_Data.csv", header=T)
setwd("~/Desktop/3-2/Introduction to Statistical Computing With R/Final Project/STAT107-team2")
data <- read.csv("00_ProstateCancer_Data.csv", header=T)
head(data)
str(data)
summary(data)
cols1 <- c("Tani_Tarihi", "Tedavi_Tarihi", "PSA_Takip_3ay", "PSA_Takip_6ay", "PSA_Takip_12ay", "BCR_Tarihi", "Metastaz_Tarihi", "Son_Takip_Tarihi")
data <- data[, !(names(data) %in% cols1)]
cols2 <- c("Klinik_Evre", "Biyopsi_Gleason", "Risk_Grubu", "Komorbidite_Skor", "Tedavi_Tipi", "ADT_Tipi", "Patolojik_Evre", "Cerrahi_Sinir", "Final_Gleason", "BCR_Durum", "Metastaz_Durum", "Son_Durum")
data[cols2] <- lapply(data[cols2], as.factor)
cols1 <- c("Tani_Tarihi", "Tedavi_Tarihi", "PSA_Takip_3ay", "PSA_Takip_6ay", "PSA_Takip_12ay", "BCR_Tarihi", "Metastaz_Tarihi", "Son_Takip_Tarihi")
data <- data[, !(names(data) %in% cols1)]
cols2 <- c("Klinik_Evre", "Biyopsi_Gleason", "Risk_Grubu", "Komorbidite_Skor", "Tedavi_Tipi", "ADT_Tipi", "Patolojik_Evre", "Cerrahi_Sinir", "Final_Gleason", "BCR_Durum", "Metastaz_Durum", "Son_Durum")
data[cols2] <- lapply(data[cols2], as.factor)
names(data) <- c("Patient ID", "Age", "PSA_before", "CTstage", "GleasonScore_before", "RiskClass", "Albumin", "Lymphocyte", "CRP", "NLR", "CallyIndex", "ComorbidityScore", "Treatment", "RadiationDose", "HormoneType", "HormonDuration" ,"TumorSize", "MarginStatus", "GleasonScore_after", "PSA_after", "BCR", "Metastasis", "Survival")
data$Delta_PSA <- data$PSA_before - data$PSA_after
vars <- c("Age", "PSA_before", "CTstage", "GleasonScore_before", "Albumin", "Lymphocyte", "CRP", "NLR", "CallyIndex", "ComorbidityScore")
pairs(data[, vars])
bcr_model <- glm(BCR ~ Age + PSA_before + CTstage + GleasonScore_before + Albumin + Lymphocyte + CRP + NLR + CallyIndex + ComorbidityScore + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model)
plot(bcr_model, which = 1)
data$Treatment <- relevel(data$Treatment, ref = 4)
bcr_model_2 <- glm( BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model_2)
data$Combination <- ifelse(data$Treatment == 4, "Yes", "No")
data$Combination <- as.factor(data$Combination)
bcr_model_2 <- glm(BCR ~ PSA_before + Combination, data = data,family = binomial, na.action = na.omit)
summary(bcr_model_2)
exp(coef(bcr_model_2))
data$Combination <- ifelse(data$Treatment == 4, "Yes", "No")
data$Combination <- as.factor(data$Combination)
bcr_model_2 <- glm(BCR ~ PSA_before + Combination, data = data,family = binomial, na.action = na.omit)
summary(bcr_model_2)
bcr_model <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model)
bcr_model <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model)
plot(bcr_model, which = 1)
data$Treatment <- relevel(data$Treatment, ref = 3)
bcr_model_t3 <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model_3)
data$Treatment <- relevel(data$Treatment, ref = 3)
bcr_model_t3 <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model_t3)
data$Treatment <- relevel(data$Treatment, ref = 3)
bcr_model_t3 <- glm(BCR ~ PSA_before + Treatment, data = data, family = binomial, na.action = na.omit)
summary(bcr_model_t3)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class (1=Low, 2=Intermediate, 3=High)",
col = rainbow(4),
pch = 19
)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class (1=Low, 2=Intermediate, 3=High)",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class (1=Low, 2=Intermediate, 3=High)",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = levels(data$RiskClass)
)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class (1=Low, 2=Intermediate, 3=High)",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
title = "Treatment Type"
)
par(mar = c(5, 4, 4, 10) + 0.1)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
title = "Treatment Type"
)
par(mar = c(5, 4, 4, 2) + 0.1)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
title = "Treatment Type"
)
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = rainbow(4),
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = rainbow(4),
pch = 19,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs. Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
cex = 0.8,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
cex = 0.2,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
cex = 0.01,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
cex = 0.001,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
cex = 0.0001,
title = "Treatment Type"
)
treatment_colors <- rainbow(length(levels(data$Treatment)))
plot(
x = data$PSA_before,
y = jitter(as.numeric(data$RiskClass), factor = 0.5),
main = "PSA_before vs Risk Class by Treatment Type",
xlab = "PSA before Treatment (ng/mL)",
ylab = "Risk Class",
col = treatment_colors[as.numeric(data$Treatment)],
pch = 19,
yaxt = "n"
)
axis(
side = 2,
at = 1:length(levels(data$RiskClass)),
labels = c("Low", "Intermediate", "High")
)
legend("topright",
legend = levels(data$Treatment),
col = treatment_colors,
pch = 19,
cex = 0.0000001,
title = "Treatment Type"
)
source("00_requirements.R")
source("00_requirements.R")
vars_for_model <- c("BCR", "PSA_before", "Treatment")
model_data <- data[complete.cases(data[, vars_for_model]), vars_for_model]
set.seed(123)
split_tag <- sample.split(model_data$BCR, SplitRatio = 0.70)
train_set <- subset(model_data, split_tag == TRUE)
test_set <- subset(model_data, split_tag == FALSE)
bcr_model_train <- glm(BCR ~ PSA_before + Treatment, data = train_set, family = binomial)
test_probabilities <- predict(bcr_model_train, newdata = test_set, type = "response")
test_predictions <- ifelse(test_probabilities > 0.5, "True", "False")
conf_matrix <- table(Predicted = test_predictions, Actual = test_set$BCR)
conf_matrix <- conf_matrix[, c("False", "True")]
cat("Confusion Matrix (Threshold 0.5):\n")
print(conf_matrix)
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
sensitivity <- conf_matrix["True", "True"] / sum(conf_matrix[, "True"])
specificity <- conf_matrix["False", "False"] / sum(conf_matrix[, "False"])
cat(sprintf("   Accuracy: %.4f\n", accuracy))
cat(sprintf("   Sensitivity: %.4f\n", sensitivity))
cat(sprintf("   Specificity: %.4f\n", specificity))
roc_obj <- roc(test_set$BCR, test_probabilities)
auc_score <- auc(roc_obj)
cat(sprintf("AUC (Area Under the Curve): %.4f\n", auc_score))
source("00_requirements.R")
vars_for_model <- c("BCR", "PSA_before", "Treatment")
model_data <- data[complete.cases(data[, vars_for_model]), vars_for_model]
set.seed(123)
split_tag <- sample.split(model_data$BCR, SplitRatio = 0.70)
train_set <- subset(model_data, split_tag == TRUE)
test_set <- subset(model_data, split_tag == FALSE)
set.seed(123)
balanced_train_data <- ovun.sample(
BCR ~ .,
data = train_set,
method = "over",
N = 2 * sum(train_set$BCR == "False")
)$data
bcr_model_train <- glm(BCR ~ PSA_before + Treatment,data = balanced_train_data, family = binomial)
test_probabilities <- predict(bcr_model_train, newdata = test_set, type = "response")
roc_obj <- roc(test_set$BCR, test_probabilities)
auc_score <- auc(roc_obj)
cat(sprintf("AUC (Area Under the Curve): %.4f\n", auc_score))
test_predictions <- ifelse(test_probabilities > 0.5, "True", "False")
conf_matrix <- table(Predicted = test_predictions, Actual = test_set$BCR)
conf_matrix <- conf_matrix[, c("False", "True")]
cat("Confusion Matrix (Threshold 0.5):\n")
print(conf_matrix)
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
sensitivity <- conf_matrix["True", "True"] / sum(conf_matrix[, "True"])
specificity <- conf_matrix["False", "False"] / sum(conf_matrix[, "False"])
cat(sprintf("   Accuracy: %.4f\n", accuracy))
cat(sprintf("   Sensitivity: %.4f\n", sensitivity))
cat(sprintf("   Specificity: %.4f\n", specificity))
